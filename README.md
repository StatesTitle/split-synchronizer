# Split Synchronizer 
[![Build Status](https://api.travis-ci.com/splitio/split-synchronizer.svg?branch=master)](https://api.travis-ci.com/splitio/split-synchronizer)

## Overview
By default, Split’s SDKs keep segment and split data synchronized as users navigate across disparate systems, treatments, and conditions. However, some languages, do not have a native capability to keep a shared local cache of this data to properly serve treatments. For these cases, we built the Split Synchronizer.

[![Twitter Follow](https://img.shields.io/twitter/follow/splitsoftware.svg?style=social&label=Follow&maxAge=1529000)](https://twitter.com/intent/follow?screen_name=splitsoftware)

## Deploying to Heroku
1. Create a Heroku app for the new Split synchronizer via
> heroku create <app_name> --space=<space> -s container --addons=heroku-redis:<plan_type>
    
  - This command creates a Heroku app named `app_name` in space `space` with the `container` stack and a Heroku Redis attachment of `plan_type`. Note that adding the Heroku Redis attachment can take 10-30 minutes.
  - For example, running ` heroku create stp-split-sync--example --space=st-staging -s container --addons=heroku-redis:hobby-dev` would create an app named `stp-split-sync--example` in the `st-staging` space with the `hobby-dev` plan of Heroku Redis

2. Attach the new synchronizer app to the `st-split` pipeline via
> heroku pipelines:add st-split -a <app_name>

3. Add the appropriate API key from Split's `Admin Settings->Workspace settings->API keys` as an environment variable `SPLIT_SYNC_API_KEY` on the new synchronizer via
> heroku config:set SPLIT_SYNC_API_KEY=<api_key> -a <app_name>

4. If either `REDIS_TLS_URL` is present or if using a Premium Heroku Redis plan (which forces TLS), we need to update how we handle TLS name validation because of how Heroku handles Automatic Certificate Management:
> heroku config:set SPLIT_SYNC_REDIS_TLS_SKIP_NAME_VALIDATION=true -a <app_name>

5. Push this codebase to the newly created app via 
> git push https://git.heroku.com/<app_name>.git master:master

See [How to deploy Synchronizer Docker Container in Heroku](https://help.split.io/hc/en-us/articles/360033291832-How-to-deploy-Synchronizer-Docker-Container-in-Heroku-) for details.

### Doma specific changes
[Heroku Redis cycles credentials/Redis URLs periodically](https://help.heroku.com/VN3D085X/why-have-my-heroku-redis-credentials-changed), and that would invalidate the environment variables that were derived from that Redis URL, which would break the synchronizer's functionality. 

We opted to parse the Redis URL that is autogenerated by the Heroku Redis attachment such that the regenerated Redis URL gets translated into the environment variables the synchronizer needs in `entrypoint.sh` instead. 

This allows us to both keep our synchronizer functional even after credential/Redis URL updates and avoid redundancy in our environment variables.

## Submitting issues 
The Split team monitors all issues submitted to this [issue tracker](https://github.com/splitio/split-synchronizer/issues). We encourage you to use this issue tracker to submit any bug reports, feedback, and feature enhancements. We'll do our best to respond in a timely manner.

## Contributing
Please see [Contributors Guide](CONTRIBUTORS-GUIDE.md) to find all you need to submit a Pull Request (PR).

## License
Licensed under the Apache License, Version 2.0. See: [Apache License](http://www.apache.org/licenses/).

## About Split

Split is the leading Feature Delivery Platform for engineering teams that want to confidently deploy features as fast as they can develop them. Split’s fine-grained management, real-time monitoring, and data-driven experimentation ensure that new features will improve the customer experience without breaking or degrading performance. Companies like Twilio, Salesforce, GoDaddy and WePay trust Split to power their feature delivery.

To learn more about Split, contact hello@split.io, or get started with feature flags for free at https://www.split.io/signup.

Please refer to [Split's official docs](https://help.split.io/hc/en-us/articles/360019686092-Split-Synchronizer-Proxy) to learn about all the functionality provided by Split Synchronizer and the configuration options available for tailoring it to your current application setup.

Split has built and maintains SDKs for:

* Java [Github](https://github.com/splitio/java-client) [Docs](https://help.split.io/hc/en-us/articles/360020405151-Java-SDK)
* Javascript [Github](https://github.com/splitio/javascript-client) [Docs](https://help.split.io/hc/en-us/articles/360020448791-JavaScript-SDK)
* Node [Github](https://github.com/splitio/javascript-client) [Docs](https://help.split.io/hc/en-us/articles/360020564931-Node-js-SDK)
* .NET [Github](https://github.com/splitio/.net-core-client) [Docs](https://help.split.io/hc/en-us/articles/360020240172--NET-SDK)
* Ruby [Github](https://github.com/splitio/ruby-client) [Docs](https://help.split.io/hc/en-us/articles/360020673251-Ruby-SDK)
* PHP [Github](https://github.com/splitio/php-client) [Docs](https://help.split.io/hc/en-us/articles/360020350372-PHP-SDK)
* Python [Github](https://github.com/splitio/python-client) [Docs](https://help.split.io/hc/en-us/articles/360020359652-Python-SDK)
* GO [Github](https://github.com/splitio/go-client) [Docs](https://help.split.io/hc/en-us/articles/360020093652-Go-SDK)
* Android [Github](https://github.com/splitio/android-client) [Docs](https://help.split.io/hc/en-us/articles/360020343291-Android-SDK)
* IOS [Github](https://github.com/splitio/ios-client) [Docs](https://help.split.io/hc/en-us/articles/360020401491-iOS-SDK)

For a comprehensive list of opensource projects visit our [Github page](https://github.com/splitio?utf8=%E2%9C%93&query=%20only%3Apublic%20).

### Compatibility
Split Synchronizer supports Go version 1.8 or higher.

**Learn more about Split:**

Visit [split.io/product](https://www.split.io/product) for an overview of Split, or visit our documentation at [docs.split.io](https://help.split.io/hc/en-us) for more detailed information.